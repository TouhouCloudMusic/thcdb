# Statistics (统计) 模块

> **实现状态**: ❌ 未实现 | [查看路线图](../ROADMAP.md#statistics)

统计系统为 THCDB 提供全面的数据分析能力，包括浏览统计、用户贡献统计和内容分析统计。

## 系统概述

统计系统收集和分析平台数据，用于：

- **内容发现**: 热门排行帮助用户发现优质内容
- **运营分析**: 了解平台使用情况和趋势
- **用户激励**: 贡献排行激励用户参与

## 浏览统计

### EntityViewCount 实体

实体浏览统计包含：

- **目标实体**: 被统计的实体类型和标识
- **总浏览量**: 历史总浏览次数
- **时段浏览量**: 今日、本周、本月的浏览次数
- **最后浏览时间**: 最近一次被浏览的时间

### 可统计的实体类型

见 [EntityType](../shared-types.md#entitytype)。

### 浏览记录策略

为避免重复计数和滥用：

- **去重窗口**: 同一用户对同一实体在 24 小时内只计一次
- **匿名用户**: 基于 IP + User-Agent 去重
- **机器人过滤**: 排除已知爬虫和机器人

### 热门排行

基于浏览量生成排行榜：

- **日榜**: 今日浏览量最高的内容
- **周榜**: 本周浏览量最高的内容
- **月榜**: 本月浏览量最高的内容
- **总榜**: 历史总浏览量最高的内容

## 用户贡献统计

### UserContributionStats 实体

用户贡献统计包含：

- **修正统计**: 提交、批准、拒绝的修正数量
- **评论数**: 用户发表的评论数量
- **收到的喜欢数**: 用户内容收到的喜欢数量
- **贡献分数**: 综合贡献分数
- **最后贡献时间**: 最近一次贡献的时间

### 贡献分数计算

```
contribution_score =
    corrections_approved * 10 +
    corrections_submitted * 2 +
    comments_count * 1
```

### 贡献者排行榜

- **总贡献榜**: 按贡献分数排名
- **修正达人**: 按批准修正数排名
- **活跃用户**: 按近期活动排名

## 内容分析统计

### 标签使用统计

- **标签热度**: 各标签被使用的次数
- **标签分布**: 各标签在不同实体类型上的分布
- **标签趋势**: 标签使用量的时间变化

### 发行统计

- **类型分布**: Album / EP / Single 等的数量分布
- **年份分布**: 各年份的发行版本数量
- **艺人产出**: 各艺人的发行版本数量

## 数据更新策略

### 实时更新

- 浏览量计数（通过队列异步处理）
- 喜欢数量

### 定时更新

- 贡献统计：每小时更新
- 排行榜：每小时更新
- 内容分析：每日更新

### 缓存策略

- 热门排行使用 Redis 缓存
- 缓存 TTL：15 分钟（热门数据）
- 缓存 TTL：1 小时（统计数据）

## API 端点 (待实现)

### 浏览统计

| 端点 | 方法 | 说明 |
|------|------|------|
| `/{entity_type}/{id}/view` | POST | 记录浏览 |
| `/stats/popular/{entity_type}` | GET | 热门内容 |
| `/stats/popular/{entity_type}/daily` | GET | 日榜 |
| `/stats/popular/{entity_type}/weekly` | GET | 周榜 |
| `/stats/popular/{entity_type}/monthly` | GET | 月榜 |

### 用户贡献

| 端点 | 方法 | 说明 |
|------|------|------|
| `/stats/user/{id}` | GET | 用户贡献统计 |
| `/stats/contributors` | GET | 贡献者排行 |
| `/stats/contributors/corrections` | GET | 修正达人排行 |

### 内容分析

| 端点 | 方法 | 说明 |
|------|------|------|
| `/stats/tags` | GET | 标签统计 |
| `/stats/releases/by-year` | GET | 年份发行分布 |
| `/stats/releases/by-type` | GET | 类型发行分布 |
| `/stats/overview` | GET | 系统概览 |
